# Default values for red-potato Helm chart

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# Backend configuration
backend:
  replicaCount: 2
  image:
    repository: ghcr.io/teodorchr/red-potato-backend
    tag: "latest"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 3000

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend configuration
frontend:
  replicaCount: 2
  image:
    repository: ghcr.io/teodorchr/red-potato-frontend
    tag: "latest"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 80

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi

  nodeSelector: {}
  tolerations: []
  affinity: {}

  livenessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
    pullPolicy: IfNotPresent

  auth:
    database: red_potato
    username: postgres
    # Password should be provided via --set or external secret
    existingSecret: ""
    secretKeys:
      passwordKey: postgres-password

  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""

    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi

  # Use external database instead of deploying PostgreSQL
  external:
    enabled: false
    host: ""
    port: 5432
    database: red_potato
    username: postgres
    existingSecret: ""
    secretKeys:
      passwordKey: postgres-password

# Application configuration
config:
  # JWT settings
  jwtSecret: ""
  jwtExpiresIn: "7d"

  # CORS
  corsOrigin: ""

  # Cron job settings
  cronEnabled: true
  cronTimezone: "Europe/Bucharest"
  itpReminderDays: 7

  # Twilio SMS settings (optional)
  twilio:
    enabled: false
    accountSid: ""
    authToken: ""
    phoneNumber: ""
    existingSecret: ""
    secretKeys:
      accountSidKey: twilio-account-sid
      authTokenKey: twilio-auth-token
      phoneNumberKey: twilio-phone-number

  # Email settings (optional)
  email:
    enabled: false
    host: "smtp.gmail.com"
    port: 587
    secure: false
    user: ""
    password: ""
    from: "Service Auto <noreply@serviceauto.ro>"
    existingSecret: ""
    secretKeys:
      userKey: email-user
      passwordKey: email-password

  # Seed passwords for initial setup
  seed:
    adminPassword: ""
    operatorPassword: ""
    existingSecret: ""
    secretKeys:
      adminPasswordKey: seed-admin-password
      operatorPasswordKey: seed-operator-password

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: red-potato.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: backend
  tls: []
  #  - secretName: red-potato-tls
  #    hosts:
  #      - red-potato.local

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext:
  fsGroup: 1000

# Security Context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
